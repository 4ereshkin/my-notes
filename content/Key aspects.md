# Основные моменты

1. **Калибровка и интеграция датчиков**  
   - Калибровка множества сенсоров (лидары, камеры, радары, IMU, GPS) — сложная и открытая задача.  
   - В литературе часто описываются решения под узкие конфигурации сенсоров, что затрудняет их обобщение.  
   - В промышленности обычно разрабатывают собственное программное обеспечение для совместной калибровки, так как готовых академических или коммерческих решений практически нет.  
   - Особую сложность представляет калибровка и интеграция нескольких лидаров и камер с разными параметрами (широкоугольные, стереопары и т.д.).  
   - Важно учитывать возможные ошибки калибровки, вызванные вибрациями и изменениями положения сенсоров во время эксплуатации.

2. **Типы задач в 3D-восприятии**  
   - Основные задачи: 3D-обнаружение объектов (3D bounding boxes), 3D паноптическая сегментация (определение класса и экземпляра для каждого лида-поинта), 3D оккупация (occupancy) — построение полного представления сцены.  
   - 3D оккупация дает более полное и непрерывное описание сцены, удобное для планирования движения и передачи неопределенности.

3. **Виды представления данных лидаров**  
   - **Воксели (Voxel grids):** трехмерная сетка, где каждый воксель содержит статистику или признаки точек. Сохраняет метрическое 3D-пространство, но вычислительно затратен (растет кубически с размером области).  
   - **Bird’s Eye View (BEV):** проекция вокселей на плоскость XY (высота Z сворачивается), что снижает размерность и вычислительную нагрузку.  
   - **Range View:** изображение в координатах углов сканирования лидара, очень плотное, позволяет использовать 2D-свертки, но сложнее восстанавливать 3D-геометрию.  
   - **Point sets:** набор необработанных 3D-точек. Высокоточные, но имеют нерегулярный доступ к памяти и сложны для многоуровневого анализа.

4. **Оптимизации работы с лидарами**  
   - Использование разреженных сверток (Sparse Convolutions) и субманифолдных сверток (Submanifold Sparse Convolutions), которые сохраняют разреженность данных на протяжении слоев нейросети, снижая вычислительные затраты.  
   - Адаптивное распространение признаков вокруг объектов для улучшения обнаружения, особенно на границах.

5. **Камера и 3D-восприятие**  
   - Камера дает 2D-изображения, которые необходимо "поднять" в 3D-пространство.  
   - Три подхода к подъему в 3D:  
     - На уровне входных данных — предсказание глубины (depth map) и создание псевдо-лидара.  
     - На уровне признаков — предсказание распределения глубины для каждого пикселя и проекция признаков камеры в 3D.  
     - На уровне вывода — сначала 2D-детекция, затем преобразование результатов в 3D.  
   - Подъем на уровне признаков считается лучше балансом между точностью и вычислительной нагрузкой.

6. **Фьюжн (слияние) данных с лидаров и камер**  
   - **Каскадный фьюжн:** сначала 2D-детекция на изображении, затем локализация с помощью лидара. Недостаток — упущение объектов, не распознанных камерой.  
   - **Фьюжн на уровне вывода:** независимые детекторы по обоим сенсорам, потом объединение результатов, что требует сложных эвристик.  
   - **Фьюжн на уровне входа:** проекция семантики из камеры на точки лидара, совместная обработка в 3D. Позволяет глубже интегрировать данные, но требует точной калибровки.  
   - **Фьюжн на уровне признаков (feature-level fusion):** проекция признаков камеры и лидара в общее пространство (например, в BEV), объединение признаков и совместная обработка. Более устойчива к небольшим ошибкам калибровки и более эффективна в плане обучения.

7. **Использование высокоточных карт (HD maps)**  
   - Карты предоставляют информацию о высоте земли, что позволяет выравнивать точечные облака лидара по уровню дороги, упрощая обучение и повышая качество восприятия.  
   - Семантические слои карт (например, полосы движения и направление потока) дают мощные априорные знания для восприятия, помогают ограничить поиск объектов.  
   - Представление карты в виде графа полос движения позволяет использовать графовые нейросети или трансформеры для эффективного моделирования и прогнозирования.

8. **Обучение и вывод 3D-детекторов**  
   - Используются двух основных типа потерь:  
     - Heatmap-based loss — фиксирует пиксели, ответственные за объект, упрощая обучение.  
     - Matching-based loss — оптимизирует соответствие между предсказанными и истинными объектами без жесткого сопоставления заранее.  
   - Постобработка (например, non-maximum suppression) часто необходима для удаления дублирующих детекций.

9. **Оккупейшн (occupancy) как альтернатива детекции**  
   - Прогнозирует плотность занятости пространства, что позволяет учитывать любую форму объектов, а не только ограничиваться объёмными коробками.  
   - Позволяет лучше передавать неопределённость, полезна для планирования.  
   - Может быть реализована и как явный сеточный прогноз, и как implicit-функция, допускающая запросы в произвольных точках пространства с учётом времени.

10. **Память в системах восприятия**  
    - Агрегация информации за длительный период улучшает качество восприятия, особенно при частичных или временных окклюзиях.  
    - Традиционные подходы используют трекинг и ассоциацию объектов во времени (handcrafted, требует много настройки).  
    - Более современные — использование объектно-уровневой памяти с сохранением признаков из предыдущих кадров, без жёсткой ассоциации.  
    - Самый продвинутый подход — использование плотной памяти признаков (dense feature memory), где сохраняется карта признаков сцены, позволяющая быстро обновлять и объединять информацию.

11. **Обработка неизвестных и редких объектов (Open set perception)**  
    - Используются методы кластеризации в нейросетевом эмбеддинг-пространстве для разделения объектов без заранее заданных классов.  
    - Итеративное обучение с псевдоразметкой и отслеживанием позволяет улучшать детекцию редко встречающихся или ранее неизвестных объектов.  
    - Интеграция с мультимодальными языковыми моделями (Vision-Language Models) позволяет осуществлять открытый словарный поиск объектов без прямой разметки на обучении.  
    - Эти approaches позволяют обнаруживать и классифицировать объекты, которые отсутствуют в обучающей выборке.

12. **Самостоятельное обучение оккупейшн (self-supervised occupancy)**  
    - Использование лучей лидара как прокси для занятости пространства: участки до отражения считаются свободными, точка отражения — занятая.  
    - Обучение implicit occupancy модели без разметки, что позволяет восприятию любых объектов, включая неожиданные.  
    - Позволяет строить представления сцены, которые включают объекты разной формы и степени уверенности.

13. **Вопросы практического применения и адаптация**  
    - Изменение конфигурации сенсоров требует повторной калибровки и возможной адаптации модели.  
    - Использование симуляторов помогает генерировать данные для обучения с новыми сенсорными установками.  
    - Важно сохранять возможность обучения модели на разных конфигурациях, чтобы использовать исторические данные и минимизировать эффект domain gap.

# Ключевые выводы

1. **Калибровка — главный узкий момент**  
   - Отсутствие универсальных и общедоступных решений по калибровке множества сенсоров заставляет компании разрабатывать собственные методы.  
   - Небольшие ошибки в калибровке могут компенсироваться на уровне нейросети, если есть возможность глубокой обработки и объединения признаков.

2. **Разные представления данных лидаров и камер имеют свои плюсы и минусы**  
   - Выбор представления — компромисс между точностью, вычислительной сложностью и возможностями последующей обработки.  
   - Комбинирование разных представлений позволяет использовать их сильные стороны.

3. **Фьюжн сенсоров на уровне признаков — наиболее перспективное направление**  
   - Позволяет эффективно интегрировать данные, нивелировать ошибки калибровки и обучать модели более устойчиво.  
   - Однако требует больше ресурсов и хорошо отлаженного программного обеспечения.

4. **Высокоточные карты существенно упрощают и улучшают восприятие**  
   - Использование карт для выравнивания по высоте и внесения семантических априорий — мощный инструмент.  
   - Позволяет снизить размерность задачи и ускорить обучение.

5. **Оккупейшн-методы становятся важным дополнением или альтернативой традиционной детекции**  
   - Они дают более полное и гибкое описание сцены, что критично для сложных и динамичных сред.  
   - Имплицитные представления позволяют избежать жесткой дискретизации и работать с непрерывным пространством и временем.

6. **Память и долговременное накопление информации — ключ к устойчивому восприятию и работе в реальном времени**  
   - Позволяет работать с окклюзиями, шумами и динамикой сцены.  
   - Современные методы памяти более гибкие и менее зависят от ручного трекинга.

7. **Обработка неизвестных объектов и открытый словарный поиск — важная и активно развивающаяся область**  
   - Методы без разметки и с использованием языковых моделей позволяют охватить гораздо большее разнообразие объектов.  
   - Это критично для реальных приложений, где невозможно заранее учесть все возможные типы объектов.

8. **Обучение без разметки и self-supervised методы могут значительно упростить развитие систем**  
   - Они позволяют строить более универсальные модели и быстро адаптироваться к новым условиям и объектам.

9. **Практические аспекты: адаптация к изменению сенсорного оборудования и условиям**  
   - Важна гибкость модели и возможность использовать симуляцию для генерации данных.  
   - Калибровка и точное знание параметров сенсоров — фундамент для успешной адаптации.

# Важные детали

1. **Калибровка**  
   - Совместная калибровка камер, лидаров, IMU, GPS — требует сложного программного обеспечения.  
   - Пример: однокамерный + один лидар — просто, а мульти-камеры + мульти-лидары — крайне сложно.  
   - Вибрации и изменения положения сенсоров требуют учета динамических ошибок калибровки.  
   - В некоторых случаях калибровка может быть не идеальной, но глубокие модели способны компенсировать небольшие ошибки.

2. **Представления лидаров**  
   - Воксели: хорошо подходят для 3D сверточных сетей, но кубический рост вычислений ограничивает масштаб.  
   - BEV: упрощение в пространстве, позволяет использовать 2D-свертки, эффективно для автономного вождения.  
   - Range View: плотные 2D-изображения с данными о дальности, удобны для быстрого анализа, но не сохраняют 3D-метрики.  
   - Point clouds: наилучшая точность локализации, но проблема с нерегулярностью и вычислительной сложностью.

3. **Оптимизации**  
   - Submanifold Sparse Convolutions: сохраняют разреженность входных данных на протяжении слоев, уменьшая вычисления.  
   - Adaptive feature diffusion: распространение признаков вокруг объектов для лучшего распознавания краевых областей.

4. **Камеры и 3D**  
   - Методы подъема в 3D:  
     - Предсказание ключевых точек в 2D и сопоставление с шаблонами.  
     - Предсказание карты глубины и создание псевдо-лидара.  
     - Проекция признаков с распределением глубины для формирования 3D-фич.  
   - Камеры дают богатую информацию о семантике и текстуре, которую можно использовать на разных этапах.

5. **Фьюжн сенсоров**  
   - Каскадный метод: 2D-детекция + локализация лидаром — прост, но ограничен.  
   - Фьюжн на уровне вывода — сложен из-за необходимости эвристик.  
   - Входной и признаковый фьюжн — наиболее продвинутые варианты, с feature-level fusion наиболее гибкий и мощный.  
   - Feature-level fusion позволяет компенсировать ошибки калибровки и интегрировать данные на более глубоком уровне.

6. **Использование HD карт**  
   - Карты позволяют задавать опорные уровни (высоту земли) и семантические слои (полосы движения, направления).  
   - Это снижает вариативность данных и повышает устойчивость восприятия.  
   - Представление карт в виде графов позволяет использовать современные методы глубокого обучения (Graph Neural Networks, Transformers).

7. **Обучение 3D детекторов**  
   - Heatmap loss позволяет учить детектор, указывая пиксели-ответственные за объект.  
   - Matching loss (Hungarian matching) более гибкий, не требует жестких предопределений, но сложнее.  
   - Postprocessing (NMS) необходим для устранения дубликатов.

8. **Оккупейшн**  
   - Явное — сеточный прогноз с вероятностями занятости.  
   - Имплицитное — функция, возвращающая вероятность занятости для произвольной точки пространства и времени.  
   - Имплицитное представление позволяет запросы с произвольной точностью и временной привязкой.

9. **Память**  
   - Традиционный трекинг основан на жестких ассоциациях и сложен в настройке.  
   - Объектно-уровневая память передает результаты предыдущих выводов как вход для текущего кадра.  
   - Плотная память признаков (dense feature memory) сохраняет карту признаков сцены, позволяя быстро обновлять и интегрировать новые данные с предыдущими.

10. **Open set perception и unsupervised learning**  
    - Кластеризация в эмбеддинг-пространстве для безклассовой сегментации объектов.  
    - Использование псевдоразметки и итеративного обучения для расширения охвата объектов.  
    - Интеграция с Vision-Language Models позволяет классифицировать объекты на основе текстового запроса без явной разметки.

11. **Self-supervised occupancy**  
    - Использование информации о лучах лидара (занятость и свободное пространство) для обучения модели без разметки.  
    - Позволяет обнаруживать объекты и строить окклюзионно-устойчивые модели сцены.

12. **Практические вопросы**  
    - Изменения в сенсорном наборе требуют переобучения и адаптации моделей.  
    - Использование симуляции помогает покрыть новые конфигурации.  
    - Калибровка и точное знание параметров сенсоров критичны для успешного переноса и обучения.  
    - Важно сохранять возможность использовать старые данные для обучения и избегать забывания.

13. **Вопросы устойчивости и аугментации**  
    - Учёт ошибок калибровки и вибраций через аугментации во время обучения (шум Гаусса, случайные кропы, падение камер) помогает повысить устойчивость моделей.  
    - Большие декодеры с широким рецептивным полем лучше справляются с ошибками калибровки.

14. **Перспективы и направления развития**
    - Sparse fusion, где объединение происходит на разреженных признаках, ещё малоисследовано, но перспективно.  
    - Развитие foundation моделей с обучением без явной разметки и последующей дообучением на конкретных задачах.  
    - Исследование физических свойств объектов (например, плотности, проходимости) для более глубокого понимания сцены.

# Итог

Это был очень детальный обзор современных подходов к 3D восприятию в автономных системах, с акцентом на интеграцию множества сенсоров, эффективные представления данных, алгоритмы обучения и практические аспекты внедрения. Основные сложности лежат в калибровке, обработке разреженных данных, фьюжне и учёте долгосрочной памяти. Новые методы открытого восприятия и самообучения обещают существенно расширить возможности систем, позволяя им работать с непредсказуемыми объектами и сценариями без дорогостоящей ручной разметки.